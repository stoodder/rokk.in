(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb={}.hasOwnProperty,mb=function(a,b){function c(){this.constructor=a}for(var d in b)lb.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},nb=[].slice;if(K=/((http\:\/\/|https\:\/\/|ftp\:\/\/)|(www\.))+(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,e=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/gi,J=/#[a-z0-9_]+/gi,m=/@[a-z0-9_]+/gi,M=function(){var a,b,c,d,e;return a=null!=(b=(null!=(c=(null!=(d=navigator.appVersion)?d:"").match(/(\(| )([^;]+)/gi))?c:["",""])[1])?b:"",a=a.toLowerCase().slice(1),[a.indexOf("msie")>-1,parseInt(null!=(e=a.split(" ",2)[1])?e:"0")]}(),h=M[0],g=M[1],k=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,j=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i),l=navigator.userAgent.match(/iPad/i),i=j||l,c=function(a,b){var c,d,e,f;return c=parseInt(null!=(e=a.get("id"))?e:-1),d=parseInt(null!=(f=b.get("id"))?f:-1),c>d?-1:d>c?1:0},ko.extenders.errorable=function(a){return a.error=ko.observable(""),a.has_error=ko.computed(function(){var b;return b=a.error(),_.isString(b)||(b=""),_.trim(b).length>0}),a.clear_error=function(){return a.error("")},a},ko.extenders.resetAfter=function(a,b){var c;return c=ko.utils.unwrapObservable(a),a.subscribe(function(d){return d!==c?setTimeout(function(){return a(c)},b):void 0}),a},this.Helpers=f={escapeHTML:function(a){_.isString(a)||(a="")},removeEntityHtmlFromText:function(a){return a=$("<div/>").html(a).text(),a.replace(/<[^>]+>/gi," ")},replaceHtmlEntitiesWithText:function(a){return a=ko.unwrap(a),a=a.replace("&nbsp;"," "),a=a.replace("&lt;","<"),a=a.replace("&gt;",">"),a=a.replace("&amp;","&")},concat:function(){var a,b,c,d;for(b="",c=0,d=arguments.length;d>c;c++)a=arguments[c],b+=unwrap(a);return b},isEmail:function(a){return a=unwrap(a),_.isString(a)||(a=""),a=_.trim(a),new RegExp(e).test(a)},isUrl:function(a){return a=unwrap(a),_.isString(a)||(a=""),a=_.trim(a),new RegExp(K).test(a)},resize_image:function(a,b){var c;return a=null!=(c=ko.unwrap(a))?c:"",a.replace("-large.","-"+b+".")}},_.mixin({trim:function(a){return null==a?"":a.toString().replace(/^\s+/,"").replace(/\s+$/,"")}}),G=function(a){function b(){return N=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.makeUrl=function(a,c){var d,e;return d=Falcon.baseApiUrl,Falcon.baseApiUrl="",e=b.__super__.makeUrl.call(this,a,c),Falcon.baseApiUrl=d,e},b.prototype.sync=function(a,b,c){var d,e,f,g,h=this;switch(_.isString(a)||(a="GET"),a=_.trim(a).toUpperCase(),"GET"!==a&&"POST"!==a&&"PUT"!==a&&"DELETE"!==a&&(a="GET"),null==c&&(c=this),null==b&&(b={}),null==b.fill&&(b.fill=!0),null==b.success&&(b.success=function(){}),null==b.error&&(b.error=function(){}),null==b.complete&&(b.complete=function(){}),null==b.params&&(b.params={}),null!=b.access_token&&SC.accessToken(b.access_token),f=null!=(g=b.url)?g:this.makeUrl(a,this.parent),d=function(a,d){var e;return e=h.parse(a,b),b.fill&&h.fill(e),d?b.error.call(c,h,a,d):b.success.call(c,h,a),b.complete.call(c,h,a)},a){case"GET":e="get";break;case"POST":e="post";break;case"PUT":e="put";break;case"DELETE":e="delete"}return SC[e](f,b.params,d)},b}(Falcon.Model),E=function(a){function b(){return Y=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="session",b.prototype.defaults={soundcloud_access_token:""},b.prototype.makeUrl=function(){return(Falcon.baseApiUrl+"/"+this.url).replace(/([^:])\/\//gi,"$1/")},b.prototype.toUser=function(){var a;return a=new L(this.serialize()),a.sc_user.url="/me",a.sc_user.makeUrl=function(){return this.url},a.sc_user.activities=new o(a.sc_user),a},b}(Falcon.Model),p=function(a){function b(){return eb=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="activities",b.prototype.defaults={tags:"",type:"",created_at:null,track:function(){return new y},playlist:function(){return new w},user:function(){return new A}},b.prototype.parse=function(a){var b;return b={created_at:a.created_at,tags:a.tags,type:a.type},"track"===a.type?b.track=a.origin:"playlist"===a.type?b.playlist=a.origin:"favoriting"===a.type&&(b.user=a.origin.user,b.track=a.origin.track),b},b}(G),q=function(a){function b(){return fb=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="apps",b}(G),s=function(a){function b(){return gb=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="comments",b}(G),u=function(a){function b(){return hb=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="groups",b}(G),w=function(a){function b(){return ib=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="playlists",b}(G),y=function(a){function b(){return jb=b.__super__.constructor.apply(this,arguments)}var c;return mb(b,a),b.prototype.url="tracks",c=null,b.stopCurrent=function(){return c instanceof b?(c.stop(),c=null):void 0},b.setCurrentlyPlaying=function(a){return this.stopCurrent(),a instanceof b?c=a:void 0},b.prototype.is_playing=!1,b.prototype.sound=null,b.prototype.defaults={created_at:null,title:"",permalink_url:"",sharing:"",embeddable_by:"",purchase_url:"",artwork_url:"",description:"",duration:0,genre:"",shared_to_count:0,release:0,release_day:0,release_month:0,release_year:0,streamable:!1,downloadable:!1,state:"",license:"",track_type:"",waveform_url:"",download_url:"",stream_url:"",video_url:"",bpm:0,commentable:!1,isrc:"",key_signature:"",comment_count:0,download_count:0,playback_count:0,favoritings_count:0,original_format:"",original_content_size:0,user_favorite:!1,user:function(){return new A},label:function(){return new A},created_with:function(){return new q},comments:function(){return new t(this)},favorites:function(){return new B(this)},shared_to:function(){var a;return a=new B(this),a.url="shared-to/users",a}},b.prototype.observables={is_playing:!1},b.prototype.togglePlay=function(){return this.is_playing?this.stop():this.play},b.prototype.play=function(){var a=this;if(!this.is_playing())return this.sound?this.sound.play():SC.stream("/tracks/"+this.get("id"),function(c,d){return console.log(d),b.setCurrentlyPlaying(a),a.sound=c,a.sound.play(),a.is_playing(!0)})},b.prototype.stop=function(){return this.is_playing()?(this.sound.stop(),this.is_playing(!1)):void 0},b}(G),A=function(a){function b(){return kb=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="users",b.prototype.defaults={username:"",permalink_url:"",avatar_url:"",country:"",full_name:"",city:"",description:"",website:"",website_title:"",track_count:0,playlist_count:0,followers_count:0,followings_count:0,public_favorites_count:0,tracks:function(){return new z(this)},playlists:function(){return new x(this)},followers:function(){var a;return a=new B(this),a.url="followers",a},followings:function(){var a;return a=new B(this),a.url="followings",a},comments:function(){return new t(this)},favorites:function(){var a;return a=new z(this),a.url="favorites",a},groups:function(){return new v(this)},"web-profiles":function(){return new D(this)}},b}(G),C=function(a){function b(){return O=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="web-profiles",b}(G),L=function(a){function b(){return P=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.url="user",b.prototype.defaults={soundcloud_access_token:"",full_name:"",soundcloud_id:"",avatar_url:"",created_at:null,updated_at:null,sc_user:function(){return new A}},b}(Falcon.Model),F=function(a){function b(){return Q=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.makeUrl=function(a,c){var d,e;return d=Falcon.baseApiUrl,Falcon.baseApiUrl="",e=b.__super__.makeUrl.call(this,a,c),Falcon.baseApiUrl=d,e},b.prototype.sync=function(a,b,c){return G.prototype.sync.call(this,a,b,c)},b}(Falcon.Collection),o=function(a){function b(){return R=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.model=p,b.prototype.parse=function(a){var b;return function(){var c,d,e,f,g;for(f=null!=(e=a.collection)?e:[],g=[],c=0,d=f.length;d>c;c++)b=f[c],g.push(p.prototype.parse(b));return g}()},b.prototype.fetchTracks=function(){var a,b,c;return a=1<=arguments.length?nb.call(arguments,0):[],b=this.url,this.url="activities/tracks",c=this.fetch.apply(this,a),this.url=b,c},b}(F),r=function(a){function b(){return S=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.model=q,b}(Falcon.Collection),t=function(a){function b(){return T=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.model=s,b}(F),v=function(a){function b(){return U=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.model=u,b}(F),x=function(a){function b(){return V=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.model=w,b}(F),z=function(a){function b(){return W=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.model=y,b}(F),B=function(a){function b(){return X=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.model=A,b}(F),D=function(a){function b(){return Z=b.__super__.constructor.apply(this,arguments)}return mb(b,a),b.prototype.model=C,b}(F),b=function(a){function b(){return ab=b.__super__.constructor.apply(this,arguments)}var c;return mb(b,a),b.prototype.url="#application-tmpl",c={},b.prototype.defaults={splash_view:function(){return new H}},b.prototype.observables={current_user:null,content_view:null,modal_view:null,is_logged_in:!1,is_checking_session:!1,is_connecting:!1,is_showing_modal:!1,is_dashboard_selected:function(){return this.content_view()instanceof d},is_stream_selected:function(){return this.content_view()instanceof I}},b.prototype.checkSession=function(){var a=this;if(!this.is_checking_session())return this.is_checking_session(!0),(new E).fetch({success:function(b){return a.login(b)},error:function(){return a.is_checking_session(!1)}})},b.prototype.login=function(a){var b,c,d=this;if(a instanceof E)return _.isEmpty(b=a.get("soundcloud_access_token"))?!1:(c=a.toUser(),SC.accessToken(b),c.sc_user.fetch({access_token:b,success:function(){return c.sc_user.fill(c.sc_user.unwrap()),d.current_user(c),d.is_logged_in(!0),d.notifySubscribers()},complete:function(){return d.is_checking_session(!1)}}))},b.prototype.logout=function(){var a=this;if(this.is_logged_in())return(new E).destroy({success:function(){return a.current_user(null),SC.accessToken(null),a.is_logged_in(!1),a.notifySubscribers()}})},b.prototype.connect=function(a){var b;return this.is_connecting(!0),_.isFunction(a)&&(a={success:a}),null==a&&(a={}),null==a.success&&(a.success=function(){}),null==a.error&&(a.error=function(){}),null==a.complete&&(a.complete=function(){}),c=a,b=SC.connect(function(){}),console.log(b),setTimeout(function(){return c===a?(b.options.window.close(),c.error("timeout","Connect timed out"),c.complete(),c=null):void 0},3e4),{abort:function(){return c===a?(c.error("abortted","User canceled request"),c.complete(),c=null):void 0}}},b.prototype.connectResponse=function(a,b){return this.is_connecting()?(this.is_connecting(!1),"success"===a?(SC.connectCallback(),c.success(SC.accessToken()),c.complete(),c=null):(c.error(b.error,b.error_description),c.complete(),c=null,SC.connectCallback())):void 0},b.prototype.setContentView=function(a){return Falcon.isView(a)?(this.content_view(a),this.notifySubscribers()):void 0},b.prototype.notifySubscribers=function(){var a;if(Falcon.isView(a=this.content_view()))return this.trigger("update:user",this.current_user())},b}(Falcon.View),d=function(b){function c(){return bb=c.__super__.constructor.apply(this,arguments)}return mb(c,b),c.prototype.url="#dashboard-tmpl",c.prototype.observables={current_user:null},c.prototype.initialize=function(){return a.on("update:user",this.updateCurrentUser,this)},c.prototype.dispose=function(){return a.off("update:user",this.updateCurrentUser)},c.prototype.updateCurrentUser=function(a){return a!==this.current_user()?(this.current_user(a),this.fetchInformation()):void 0},c.prototype.fetchInformation=function(){var a;!((a=this.current_user())instanceof L)},c}(Falcon.View),H=function(b){function c(){return cb=c.__super__.constructor.apply(this,arguments)}return mb(c,b),c.prototype.url="#splash-tmpl",c.prototype.observables={is_loading:!1,is_connected:!1},c.prototype.connect=function(){var b=this;if(!this.is_loading())return this.is_loading(!0),this.is_connected(!1),a.connect({success:function(a){return b.is_connected(!0),b.login(a)},error:function(a,c){return console.log(a,c),b.is_loading(!1)}})},c.prototype.login=function(b){var c=this;if(null!=b&&this.is_connected())return new E({soundcloud_access_token:b}).create({attributes:["soundcloud_access_token"],success:function(b){return a.login(b),c.is_loading(!1),c.is_connected(!1)},error:function(){return c.register(b)}})},c.prototype.register=function(b){var c=this;if(null!=b&&this.is_connected()&&!a.is_logged_in())return new L({soundcloud_access_token:b}).create({attributes:["soundcloud_access_token"],success:function(){var b=this;return(new E).fetch({success:function(b){return a.login(b)},complete:function(){return b.is_connected(!1),b.is_loading(!1)}})},error:function(){return c.is_loading(!1),c.is_connected(!1)}})},c}(Falcon.View),I=function(b){function c(){return db=c.__super__.constructor.apply(this,arguments)}return mb(c,b),c.prototype.url="#stream-tmpl",c.prototype.defaults={tracks:function(){return new z}},c.prototype.observables={is_loading:!1,current_user:null},c.prototype.initialize=function(){return a.on("update:user",this.updateCurrentUser,this)},c.prototype.dispose=function(){return a.off("update:user",this.updateCurrentUser)},c.prototype.updateCurrentUser=function(a){return a!==this.current_user()?(this.current_user(a),this.fetchInformation()):void 0},c.prototype.fetchInformation=function(){var a,b=this;if((a=this.current_user())instanceof L&&!this.is_loading())return this.is_loading(!0),a.sc_user.activities.fetchTracks({complete:function(){return b.is_loading(!1)}})},c}(Falcon.View),Falcon.addBinding("src",function(a,b){var c;return c=ko.unwrap(b()),a.setAttribute("src",c)}),Finch.route("/",{setup:function(){return a.checkSession()},load:function(){return a.setContentView(new d)}}),Finch.route("[/]stream",{setup:function(){return this.view=new I,a.setContentView(this.view)}}),this.Router=n={gotoDashboard:function(){return Finch.navigate("/")},gotoStream:function(){return Finch.navigate("/stream")}},"undefined"==typeof ENV||null===ENV)throw"Could not find ENV variables";this.Application=a=new b,SC.initialize({client_id:ENV.SOUNDCLOUD_CLIENT_ID,redirect_uri:ENV.SOUNDCLOUD_REDIRECT_URL}),balanced.init(ENV.BALANCED_MAKRETPLACE_URI),Falcon.apply(a),Finch.listen()}).call(this);