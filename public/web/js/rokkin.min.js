(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb=[].slice,sb={}.hasOwnProperty,tb=function(a,b){function c(){this.constructor=a}for(var d in b)sb.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};if(N=/((http\:\/\/|https\:\/\/|ftp\:\/\/)|(www\.))+(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,e=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/gi,M=/#[a-z0-9_]+/gi,m=/@[a-z0-9_]+/gi,P=function(){var a,b,c,d,e;return a=null!=(b=(null!=(c=(null!=(d=navigator.appVersion)?d:"").match(/(\(| )([^;]+)/gi))?c:["",""])[1])?b:"",a=a.toLowerCase().slice(1),[a.indexOf("msie")>-1,parseInt(null!=(e=a.split(" ",2)[1])?e:"0")]}(),h=P[0],g=P[1],k=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,j=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i),l=navigator.userAgent.match(/iPad/i),i=j||l,c=function(a,b){var c,d,e,f;return c=parseInt(null!=(e=a.get("id"))?e:-1),d=parseInt(null!=(f=b.get("id"))?f:-1),c>d?-1:d>c?1:0},ko.extenders.errorable=function(a){return a.error=ko.observable(""),a.has_error=ko.computed(function(){var b;return b=a.error(),_.isString(b)||(b=""),_.trim(b).length>0}),a.clear_error=function(){return a.error("")},a},ko.extenders.resetAfter=function(a,b){var c;return c=ko.utils.unwrapObservable(a),a.subscribe(function(d){return d!==c?setTimeout(function(){return a(c)},b):void 0}),a},ko.extenders.validateable=function(a){var b,c;return b=ko.observable(""),c=ko.observable(!1),a.error=ko.computed({read:function(){return b()},write:function(a){return a=_.trim((null!=a?a:"").toString()),_.isEmpty(a)||c(!1),b(a)}}),a.has_error=ko.computed(function(){return a.error().length>0}),a.is_valid=ko.computed({read:function(){return!a.has_error()&&c()},write:function(b){return b===!0&&a.error(""),c(b)}}),a.clearValidations=function(){return a.error(""),c(!1)},a},this.Helpers=f={escapeHTML:function(a){_.isString(a)||(a="")},removeEntityHtmlFromText:function(a){return a=$("<div/>").html(a).text(),a.replace(/<[^>]+>/gi," ")},replaceHtmlEntitiesWithText:function(a){return a=ko.unwrap(a),a=a.replace("&nbsp;"," "),a=a.replace("&lt;","<"),a=a.replace("&gt;",">"),a=a.replace("&amp;","&")},concat:function(){var a,b,c,d;for(b="",c=0,d=arguments.length;d>c;c++)a=arguments[c],b+=ko.unwrap(a);return b},isEmail:function(a){return a=ko.unwrap(a),_.isString(a)||(a=""),a=_.trim(a),new RegExp(e).test(a)},isUrl:function(a){return a=ko.unwrap(a),_.isString(a)||(a=""),a=_.trim(a),new RegExp(N).test(a)},resizeImage:function(a,b){var c;return a=null!=(c=ko.unwrap(a))?c:"",a.replace("-large.","-"+b+".")},formatCreditCardNumber:function(a){return a=ko.unwrap(a),a=_.trim((null!=a?a:"").toString()),a=a.replace(/[^0-9]/gi,"").slice(0,16),a=_.trim([a.slice(0,4),a.slice(4,8),a.slice(8,12),a.slice(12,16)].join(" ")).replace(/\s+/gi,"-")},creditCardImageUrl:function(a){return a=ko.unwrap(a),_.isString(a)||(a=""),a=_.trim(a).toLowerCase(),"visa"===a?"/images/cards/visa.png":"mastercard"===a?"/images/cards/mastercard.png":"discover"===a?"/images/cards/discover.png":"american express"===a?"/images/cards/amex.png":"jcb"===a?"/images/cards/jcb.png":"diners club"===a?"/images/cards/diners.png":"/images/cards/credit.png"},formatNumber:function(a,b){return a=ko.unwrap(a),null==b&&(b="0,0"),numeral(a).format(b)}},_.mixin({trim:function(a){return null==a?"":a.toString().replace(/^\s+/,"").replace(/\s+$/,"")}}),ko.subscribable.fn.classify=function(){var a,b,c,d,e;for(c=1<=arguments.length?rb.call(arguments,0):[],a={},d=0,e=c.length;e>d;d++)b=c[d],_.isString(b)&&!_.isEmpty(b)&&(a[b]=!0);return this.extend(a)},J=function(a){function b(){return Q=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.makeUrl=function(a,c,d){var e,f;return e=Falcon.baseApiUrl,Falcon.baseApiUrl="",f=b.__super__.makeUrl.call(this,a,c,d),Falcon.baseApiUrl=e,f},b.prototype.sync=function(a,b,c){var d,e,f,g,h=this;switch(_.isString(a)||(a="GET"),a=_.trim(a).toUpperCase(),"GET"!==a&&"POST"!==a&&"PUT"!==a&&"DELETE"!==a&&(a="GET"),null==c&&(c=this),null==b&&(b={}),null==b.fill&&(b.fill=!0),null==b.success&&(b.success=function(){}),null==b.error&&(b.error=function(){}),null==b.complete&&(b.complete=function(){}),null==b.params&&(b.params={}),null!=b.access_token&&SC.accessToken(b.access_token),f=null!=(g=b.url)?g:this.makeUrl(a,this.parent),d=function(a,d){var e;return e=h.parse(a,b),b.fill&&h.fill(e),d?b.error.call(c,h,a,d):b.success.call(c,h,a),b.complete.call(c,h,a)},a){case"GET":e="get";break;case"POST":e="post";break;case"PUT":e="put";break;case"DELETE":e="delete"}return SC[e](f,b.params,d)},b}(Falcon.Model),G=function(a){function b(){return bb=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="session",b.prototype.defaults={soundcloud_access_token:""},b.prototype.makeUrl=function(){return(Falcon.baseApiUrl+"/"+this.url).replace(/([^:])\/\//gi,"$1/")},b.prototype.toUser=function(){var a;return a=new O(this.serialize()),a.sc_user.url="/me",a.sc_user.makeUrl=function(){return this.url},a.sc_user.activities=new p(a.sc_user),a},b}(Falcon.Model),q=function(a){function b(){return kb=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="activities",b.prototype.defaults={tags:"",type:"",created_at:null,track:function(){return new z},playlist:function(){return new x},user:function(){return new B}},b.prototype.parse=function(a){var b;return b={created_at:a.created_at,tags:a.tags,type:a.type},"track"===a.type?b.track=a.origin:"playlist"===a.type?b.playlist=a.origin:"favoriting"===a.type&&(b.user=a.origin.user,b.track=a.origin.track),b},b}(J),r=function(a){function b(){return lb=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="apps",b}(J),t=function(a){function b(){return mb=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="comments",b}(J),v=function(a){function b(){return nb=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="groups",b}(J),x=function(a){function b(){return ob=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="playlists",b}(J),z=function(a){function b(){return pb=b.__super__.constructor.apply(this,arguments)}var c;return tb(b,a),b.prototype.url="tracks",c=null,b.stopCurrent=function(){return c instanceof b?(c.stop(),c=null):void 0},b.setCurrentlyPlaying=function(a){return this.stopCurrent(),a instanceof b?c=a:void 0},b.prototype.is_playing=!1,b.prototype.sound=null,b.prototype.defaults={created_at:null,title:"",permalink_url:"",sharing:"",embeddable_by:"",purchase_url:"",artwork_url:"",description:"",duration:0,genre:"",shared_to_count:0,release:0,release_day:0,release_month:0,release_year:0,streamable:!1,downloadable:!1,state:"",license:"",track_type:"",waveform_url:"",download_url:"",stream_url:"",video_url:"",bpm:0,commentable:!1,isrc:"",key_signature:"",comment_count:0,download_count:0,playback_count:0,favoritings_count:0,original_format:"",original_content_size:0,user_favorite:!1,user:function(){return new B},label:function(){return new B},created_with:function(){return new r},comments:function(){return new u(this)},favorites:function(){return new C(this)},shared_to:function(){var a;return a=new C(this),a.url="shared-to/users",a}},b.prototype.observables={is_playing:!1},b.prototype.togglePlay=function(){return this.is_playing?this.stop():this.play},b.prototype.play=function(){var a=this;if(!this.is_playing())return this.sound?this.sound.play():SC.stream("/tracks/"+this.get("id"),function(c,d){return console.log(d),b.setCurrentlyPlaying(a),a.sound=c,a.sound.play(),a.is_playing(!0)})},b.prototype.stop=function(){return this.is_playing()?(this.sound.stop(),this.is_playing(!1)):void 0},b}(J),B=function(a){function b(){return qb=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="users",b.prototype.defaults={username:"",permalink_url:"",avatar_url:"",country:"",full_name:"",city:"",description:"",website:"",website_title:"",track_count:0,playlist_count:0,followers_count:0,followings_count:0,public_favorites_count:0,tracks:function(){return new A(this)},playlists:function(){return new y(this)},followers:function(){var a;return a=new C(this),a.url="followers",a},followings:function(){var a;return a=new C(this),a.url="followings",a},comments:function(){return new u(this)},favorites:function(){var a;return a=new A(this),a.url="favorites",a},groups:function(){return new w(this)},"web-profiles":function(){return new E(this)}},b.prototype.fetchByUsername=function(a){return _.isFunction(a)&&(a={complete:a}),_.isObject(a)||(a={}),a.url=this.makeUrl("GET",this.parent,this.get("username")),this.fetch(a)},b}(J),D=function(a){function b(){return R=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="web-profiles",b}(J),O=function(a){function b(){return S=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.url="user",b.prototype.defaults={soundcloud_access_token:"",soundcloud_id:"",balanced_card_uri:"",balanced_customer_uri:"",balanced_bank_account_uri:"",card_last_4:"",card_type:"",card_expiration_month:0,card_expiration_year:0,bank_name:"",bank_account_number:"",full_name:"",avatar_url:"",created_at:null,updated_at:null,sc_user:function(){return new B}},b}(Falcon.Model),I=function(a){function b(){return T=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.makeUrl=function(a,c){var d,e;return d=Falcon.baseApiUrl,Falcon.baseApiUrl="",e=b.__super__.makeUrl.call(this,a,c),Falcon.baseApiUrl=d,e},b.prototype.sync=function(a,b,c){return J.prototype.sync.call(this,a,b,c)},b.prototype.search=function(a,b){return _.isString(a)&&(a={q:a}),_.isObject(a)||(a={}),_.isFunction(b)&&(b={success:b}),_.isObject(b)||(b={}),b.params=a,this.fetch(b)},b}(Falcon.Collection),p=function(a){function b(){return U=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.model=q,b.prototype.parse=function(a){var b;return function(){var c,d,e,f,g;for(f=null!=(e=a.collection)?e:[],g=[],c=0,d=f.length;d>c;c++)b=f[c],g.push(q.prototype.parse(b));return g}()},b.prototype.fetchTracks=function(){var a,b,c;return a=1<=arguments.length?rb.call(arguments,0):[],b=this.url,this.url="activities/tracks",c=this.fetch.apply(this,a),this.url=b,c},b}(I),s=function(a){function b(){return V=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.model=r,b}(Falcon.Collection),u=function(a){function b(){return W=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.model=t,b}(I),w=function(a){function b(){return X=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.model=v,b}(I),y=function(a){function b(){return Y=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.model=x,b}(I),A=function(a){function b(){return Z=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.model=z,b}(I),C=function(a){function b(){return ab=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.model=B,b}(I),E=function(a){function b(){return cb=b.__super__.constructor.apply(this,arguments)}return tb(b,a),b.prototype.model=D,b}(I),b=function(a){function b(){return db=b.__super__.constructor.apply(this,arguments)}var c;return tb(b,a),b.prototype.url="#application-tmpl",c={},b.prototype.defaults={splash_view:function(){return new K}},b.prototype.observables={current_user:null,content_view:null,modal_view:null,is_logged_in:!1,is_checking_session:!1,is_connecting:!1,is_showing_modal:!1,is_dashboard_selected:function(){return this.content_view()instanceof d},is_stream_selected:function(){return this.content_view()instanceof L},is_settings_selected:function(){return this.content_view()instanceof H},is_search_selected:function(){return this.content_view()instanceof F},search_query:""},b.prototype.checkSession=function(){var a=this;if(!this.is_checking_session())return this.is_checking_session(!0),(new G).fetch({success:function(b){return a.login(b)},error:function(){return a.is_checking_session(!1)}})},b.prototype.login=function(a){var b,c,d=this;if(a instanceof G)return _.isEmpty(b=a.get("soundcloud_access_token"))?!1:(c=a.toUser(),SC.accessToken(b),c.sc_user.fetch({access_token:b,success:function(){return c.sc_user.fill(c.sc_user.unwrap()),d.current_user(c),d.is_logged_in(!0),d.notifySubscribers()},complete:function(){return d.is_checking_session(!1)}}))},b.prototype.logout=function(){var a=this;if(this.is_logged_in())return(new G).destroy({success:function(){return a.current_user(null),SC.accessToken(null),a.is_logged_in(!1),a.notifySubscribers()}})},b.prototype.connect=function(a){var b;return this.is_connecting(!0),_.isFunction(a)&&(a={success:a}),null==a&&(a={}),null==a.success&&(a.success=function(){}),null==a.error&&(a.error=function(){}),null==a.complete&&(a.complete=function(){}),c=a,b=SC.connect(function(){}),setTimeout(function(){return c===a?(b.options.window.close(),c.error("timeout","Connect timed out"),c.complete(),c=null):void 0},3e4),{abort:function(){return c===a?(c.error("abortted","User canceled request"),c.complete(),c=null):void 0}}},b.prototype.connectResponse=function(a,b){return this.is_connecting()?(this.is_connecting(!1),"success"===a?(SC.connectCallback(),c.success(SC.accessToken()),c.complete(),c=null):(c.error(b.error,b.error_description),c.complete(),c=null,SC.connectCallback())):void 0},b.prototype.setContentView=function(a){return Falcon.isView(a)?(this.content_view(a),a):null},b.prototype.notifySubscribers=function(){var a;if(Falcon.isView(a=this.content_view()))return this.trigger("update:user",this.current_user())},b.prototype.searchSubmit=function(){return this.search(this.search_query()),!1},b.prototype.search=function(a){return _.isEmpty(a)?this.search_query(""):(null==a&&(a=""),_.isString(a)||(a=this.search_query()),a=_.trim(a),this.search_query(a),o.gotoSearch({query:a}))},b.prototype.showModal=function(){return this.is_showing_modal(!0)},b.prototype.hideModal=function(){return this.is_showing_modal(!1)},b}(Falcon.View),d=function(b){function c(){return eb=c.__super__.constructor.apply(this,arguments)}return tb(c,b),c.prototype.url="#dashboard-tmpl",c.prototype.observables={current_user:null},c.prototype.display=function(){return a.on("update:user",this.updateCurrentUser,this),this.updateCurrentUser(a.current_user())},c.prototype.dispose=function(){return a.off("update:user",this.updateCurrentUser)},c.prototype.updateCurrentUser=function(a){return a!==this.current_user()?(this.current_user(a),this.fetchInformation()):void 0},c.prototype.fetchInformation=function(){var a;!((a=this.current_user())instanceof O)},c}(Falcon.View),n=function(b){function c(){return fb=c.__super__.constructor.apply(this,arguments)}return tb(c,b),c.prototype.url="#profile-tmpl",c.prototype.defaults={user:function(a){var b;return b=new O,b.sc_user.set("id",a),b}},c.prototype.observables={current_user:null,viewing_user:function(){return this.user.sc_user.isNew()?this.current_user():this.user},is_loading:!1,has_error:!1},c.prototype.display=function(){return a.on("update:user",this.updateCurrentUser,this),this.updateCurrentUser(a.current_user())},c.prototype.dispose=function(){return a.off("update:user",this.updateCurrentUser)},c.prototype.updateCurrentUser=function(a){return a!==this.current_user()?(this.current_user(a),this.fetchInformation()):void 0},c.prototype.fetchInformation=function(){var a,b=this;if((a=this.current_user())instanceof O&&!this.is_loading()&&!a.equals(this.viewing_user))return this.is_loading(!0),this.user.sc_user.fetch({complete:function(){return b.is_loading(!1)},success:function(){return b.has_error(!1)},error:function(){return b.has_error(!0)}})},c.prototype.donate=function(){return a.showModal()},c}(Falcon.View),F=function(b){function c(){return gb=c.__super__.constructor.apply(this,arguments)}return tb(c,b),c.prototype.url="#search-tmpl",c.prototype.defaults={sc_users:function(){return new C},sc_tracks:function(){return new A}},c.prototype.observables={current_user:null,query:"",is_loading_users:!1,is_loading_tracks:!1},c.prototype.display=function(){return a.on("update:user",this.updateCurrentUser,this),this.updateCurrentUser(a.current_user())},c.prototype.dispose=function(){return a.off("update:user",this.updateCurrentUser)},c.prototype.updateCurrentUser=function(a){return a!==this.current_user()?(this.current_user(a),this.search()):void 0},c.prototype.updateQuery=function(a){return _.isString(a)||(a=""),a=_.trim(a),a!==this.query()?(this.query(a),this.search()):void 0},c.prototype.search=function(){var b,c=this;if(a.is_logged_in())return b=this.query(),_.isEmpty(b)?(this.sc_users.reset(),this.sc_tracks.reset()):(this.is_loading_users(!0),this.sc_users.search(b,function(){return c.is_loading_users(!1)}),this.is_loading_tracks(!0),this.sc_tracks.search(b,function(){return c.is_loading_tracks(!1)}))},c}(Falcon.View),H=function(b){function c(){return hb=c.__super__.constructor.apply(this,arguments)}return tb(c,b),c.prototype.url="#settings-tmpl",c.prototype.observables={alert:"",is_saving:!1,current_user:null,is_showing_personal_information:!1,is_showing_credit_card:!1,is_showing_bank_account:!1,current_credit_card_last_4:"",current_credit_card_type:"",has_credit_card:function(){return!_.isEmpty(this.current_credit_card_last_4())||!_.isEmpty(this.current_credit_card_type())},credit_card_type:"",credit_card_expiration_month:"",credit_card_expiration_year:"",credit_card_cvc:"",_credit_card_number:"",credit_card_number:{read:function(){return f.formatCreditCardNumber(this._credit_card_number)},write:function(a){return this._credit_card_number(a)}},credit_card_expiration:{read:function(){var a,b,c,d;return b=_.trim(null!=(c=ko.unwrap(this.credit_card_expiration_year))?c:""),a=_.trim(null!=(d=ko.unwrap(this.credit_card_expiration_month))?d:""),_.isEmpty(b)||_.isEmpty(a)?"":""+a+"/"+b},write:function(a){var b,c,d;return a=_.trim(null!=a?a:""),d=a.split("/"),b=d[0],c=d[1],b=_.trim(null!=b?b:""),c=_.trim(null!=c?c:""),2===c.length&&(c="20"+c),1===b.length&&(b="0"+b),c=c.slice(0,4),b=b.slice(0,2),this.credit_card_expiration_month(b),this.credit_card_expiration_year(c)}},current_bank_name:"",current_bank_account_number:"",has_bank_account:function(){return!_.isEmpty(this.current_bank_name())||!_.isEmpty(this.current_bank_account_number())},bank_account_name:"",bank_account_account_number:"",bank_account_routing_number:""},c.prototype.initialize=function(){var a=this;return this.alert.classify("validateable"),this.credit_card_number.classify("validateable"),this.credit_card_expiration.classify("validateable"),this.credit_card_cvc.classify("validateable"),this.bank_account_name.classify("validateable"),this.bank_account_account_number.classify("validateable"),this.bank_account_routing_number.classify("validateable"),ko.computed(function(){var b,c;return c=a.credit_card_number(),b=balanced.card.isCardNumberValid(c),a.credit_card_number.is_valid(b),a.credit_card_type(b?balanced.card.cardType(c):"")}),ko.computed(function(){var b,c;return a.credit_card_expiration(),b=a.credit_card_expiration_month.peek(),c=a.credit_card_expiration_year.peek(),a.credit_card_expiration.is_valid(balanced.card.isExpiryValid(b,c))}),ko.computed(function(){var b,c;return c=a.credit_card_number(),b=a.credit_card_cvc(),a.credit_card_cvc.is_valid(balanced.card.isSecurityCodeValid(c,b))}),ko.computed(function(){var b;return b=a.bank_account_name(),a.bank_account_name.is_valid(!_.isEmpty(b))}),ko.computed(function(){var b;return b=a.bank_account_account_number(),a.bank_account_account_number.is_valid(!_.isEmpty(b))}),ko.computed(function(){var b;return b=a.bank_account_routing_number(),a.bank_account_routing_number.is_valid(balanced.bankAccount.validateRoutingNumber(b))}),this.showPersonalInformation()},c.prototype.display=function(){return a.on("update:user",this.updateCurrentUser,this),this.updateCurrentUser(a.current_user())},c.prototype.dispose=function(){return a.off("update:user",this.updateCurrentUser)},c.prototype.updateCurrentUser=function(a){return a!==this.current_user()?(this.current_user(a),this.populateData()):void 0},c.prototype.populateData=function(){var a;return(a=this.current_user())instanceof O?(this.current_credit_card_last_4(a.get("card_last_4")),this.current_credit_card_type(a.get("card_type")),this.current_bank_name(a.get("bank_name")),this.current_bank_account_number(a.get("bank_account_number"))):(this.current_credit_card_last_4(""),this.current_credit_card_type(""),this.current_bank_name(""),this.current_bank_account_number(""))},c.prototype._reset=function(){return this.is_showing_personal_information(!1),this.is_showing_credit_card(!1),this.is_showing_bank_account(!1),this._resetFields()},c.prototype._resetFields=function(){return this.alert(""),this.credit_card_number(""),this.credit_card_expiration(""),this.credit_card_cvc(""),this.bank_account_name(""),this.bank_account_account_number(""),this.bank_account_routing_number(""),this._clearValidations()},c.prototype._clearValidations=function(){return this.alert.clearValidations(),this.credit_card_number.clearValidations(),this.credit_card_expiration.clearValidations(),this.credit_card_cvc.clearValidations(),this.bank_account_name.clearValidations(),this.bank_account_account_number.clearValidations(),this.bank_account_routing_number.clearValidations()},c.prototype._hasError=function(){return this.is_showing_credit_card()?this.credit_card_number.has_error()||this.credit_card_expiration.has_error()||this.credit_card_cvc.has_error():this.is_showing_bank_account()?this.bank_account_routing_number.has_error()||this.bank_account_account_number.has_error()||this.bank_account_name.has_error():!1},c.prototype.showPersonalInformation=function(){return this._reset(),this.is_showing_personal_information(!0)},c.prototype.showCreditCard=function(){return this._reset(),this.is_showing_credit_card(!0)},c.prototype.cancelSaveCreditCard=function(){return this.is_saving()?!1:confirm("Are you sure you want to cancel saving your credit card?")?this._resetFields():!1},c.prototype.saveCreditCard=function(){var a,b,c,d,e,f,g,h=this;return(f=this.current_user())instanceof O?this.is_saving()?!1:(this._clearValidations(),e=this.credit_card_number(),b=this.credit_card_expiration(),a=this.credit_card_cvc(),c=this.credit_card_expiration_month(),d=this.credit_card_expiration_year(),balanced.card.isCardNumberValid(e)||this.credit_card_number.error("Please enter a valid credit card number."),balanced.card.isExpiryValid(c,d)||this.credit_card_expiration.error("Please enter a valid expiration date."),balanced.card.isSecurityCodeValid(e,a)||this.credit_card_cvc.error("Please enter a valid CVC Number."),this._hasError()?!1:(this.credit_card_number.is_valid(!0),this.credit_card_expiration.is_valid(!0),this.credit_card_cvc.is_valid(!0),this.is_saving(!0),g=function(a){return f.clone(["id"]).set({balanced_card_uri:a}).save({attributes:["balanced_card_uri"],complete:function(){return h.is_saving(!1)},success:function(a){return f.fill(a.unwrap()),h.populateData(),h._resetFields(),h.alert("Successfully saved credit card information!")},error:function(){return h.alert.error("Error while saving credit card information")}})},balanced.card.create({card_number:e,expiration_month:c,expiration_year:d,security_code:a},function(a){switch(a.status){case 201:return g(a.data.uri);default:h.alert.error("An error occurred while saving credit card information")}return h.is_saving(!1)}),!1)):!1},c.prototype.removeCreditCard=function(){var a,b=this;return(a=this.current_user())instanceof O?a.get("balanced_card_uri")?this.is_saving()?!1:confirm("Are you sure you want to remove your credit card?")?(this.is_saving(!0),a.clone(["id"]).save({params:{remove_credit_card:!0},attributes:[],success:function(c){return a.fill(c.unwrap()),b.populateData(),b._clearValidations(),b.alert("Successfully removed credit card")},error:function(){return b.alert.error("There was an error while trying to remove your credit card")},complete:function(){return b.is_saving(!1)}}),!1):!1:!1:!1},c.prototype.showBankAccount=function(){return this._reset(),this.is_showing_bank_account(!0)},c.prototype.cancelSaveBankAccount=function(){return this.is_saving()?!1:confirm("Are you sure you want to cancel saving your bank account?")?this._resetFields():!1},c.prototype.saveBankAccount=function(){var a,b,c,d,e,f,g,h=this;return(c=this.current_user())instanceof O?this.is_saving()?!1:(this._clearValidations(),e=this.bank_account_routing_number(),a=this.bank_account_account_number(),d=this.bank_account_name(),_.isEmpty(e)&&this.bank_account_routing_number.error("Please enter a routing number"),_.isEmpty(a)&&this.bank_account_account_number.error("Please enter a account number"),_.isEmpty(d)&&this.bank_account_name.error("Please enter a name"),this._hasError()?!1:(b={routing_number:e,account_number:a,name:d},f=balanced.bankAccount.validate(b),null!=f.routing_number&&this.bank_account_routing_number.error(f.routing_number),null!=f.account_number&&this.bank_account_account_number.error(f.account_number),null!=f.name&&this.bank_account_name.error(f.name),this._hasError()?!1:(this.bank_account_routing_number.is_valid(!0),this.bank_account_account_number.is_valid(!0),this.bank_account_name.is_valid(!0),this.is_saving(!0),g=function(a){return c.clone(["id"]).set({balanced_bank_account_uri:a}).save({attributes:["balanced_bank_account_uri"],complete:function(){return h.is_saving(!1)},success:function(a){return c.fill(a.unwrap()),h.populateData(),h._resetFields(),h.alert("Successfully saved bank account information!")},error:function(){return h.alert.error("Error while saving bank account information")}})},balanced.bankAccount.create(b,function(a){switch(a.status){case 201:return g(a.data.uri);default:h.alert.error("An error occurred while saving bank account information")}return h.is_saving(!1)}),!1))):!1},c.prototype.removeBankAccount=function(){var a,b=this;return(a=this.current_user())instanceof O?a.get("balanced_bank_account_uri")?this.is_saving()?!1:confirm("Are you sure you want to remove your bank account?")?(this.is_saving(!0),a.clone(["id"]).save({params:{remove_bank_account:!0},attributes:[],success:function(c){return a.fill(c.unwrap()),b.populateData(),b._clearValidations(),b.alert("Successfully removed bank account")},error:function(){return b.alert.error("There was an error while trying to remove your credit card")},complete:function(){return b.is_saving(!1)}}),!1):!1:!1:!1},c.prototype.gotoPersonalInfomration=function(){return Finch.navigate({showing:null},!0)},c.prototype.gotoCreditCard=function(){return Finch.navigate({showing:"credit_card"},!0)},c.prototype.gotoBankAccount=function(){return Finch.navigate({showing:"bank_account"},!0)},c}(Falcon.View),K=function(b){function c(){return ib=c.__super__.constructor.apply(this,arguments)}return tb(c,b),c.prototype.url="#splash-tmpl",c.prototype.observables={is_loading:!1,is_connected:!1},c.prototype.connect=function(){var b=this;if(!this.is_loading())return this.is_loading(!0),this.is_connected(!1),a.connect({success:function(a){return b.is_connected(!0),b.login(a)},error:function(a,c){return console.log(a,c),b.is_loading(!1)}})},c.prototype.login=function(b){var c=this;if(null!=b&&this.is_connected())return new G({soundcloud_access_token:b}).create({attributes:["soundcloud_access_token"],success:function(b){return a.login(b),c.is_loading(!1),c.is_connected(!1)},error:function(){return c.register(b)}})},c.prototype.register=function(b){var c=this;if(null!=b&&this.is_connected()&&!a.is_logged_in())return new O({soundcloud_access_token:b}).create({attributes:["soundcloud_access_token"],success:function(){return(new G).fetch({success:function(b){return a.login(b)},complete:function(){return c.is_connected(!1),c.is_loading(!1)}})},error:function(){return c.is_loading(!1),c.is_connected(!1)}})},c}(Falcon.View),L=function(b){function c(){return jb=c.__super__.constructor.apply(this,arguments)}return tb(c,b),c.prototype.url="#stream-tmpl",c.prototype.defaults={tracks:function(){return new A}},c.prototype.observables={is_loading:!1,current_user:null},c.prototype.display=function(){return a.on("update:user",this.updateCurrentUser,this),this.updateCurrentUser(a.current_user())},c.prototype.dispose=function(){return a.off("update:user",this.updateCurrentUser)},c.prototype.updateCurrentUser=function(a){return a!==this.current_user()?(this.current_user(a),this.fetchInformation()):void 0},c.prototype.fetchInformation=function(){var a,b=this;if((a=this.current_user())instanceof O&&!this.is_loading())return this.is_loading(!0),a.sc_user.activities.fetchTracks({complete:function(){return b.is_loading(!1)}})},c}(Falcon.View),Falcon.addBinding("src",function(a,b){var c;return c=ko.unwrap(b()),a.setAttribute("src",c)}),Finch.route("/",{setup:function(){return a.checkSession(),Finch.observe("query",function(b){return a.search(b)})},load:function(){return a.setContentView(new d)}}),Finch.route("[/]stream",{setup:function(){return this.view=a.setContentView(new L)}}),Finch.route("[/]settings",{setup:function(){var b=this;return this.view=a.setContentView(new H),Finch.observe("showing",function(a){return"credit_card"===a?b.view.showCreditCard():"bank_account"===a?b.view.showBankAccount():b.view.showPersonalInformation()})}}),Finch.route("[/]search",{setup:function(){var b=this;return this.view=a.setContentView(new F),Finch.observe("query",function(a){return b.view.updateQuery(a)})}}),Finch.route("[/]profile",{setup:function(){return this.view=a.setContentView(new n)}}),Finch.route("[/]profile/:username",{setup:function(b){var c;return c=b.username,this.view=a.setContentView(new n(c))}}),this.Router=o={gotoDashboard:function(){return Finch.navigate("/")},gotoStream:function(){return Finch.navigate("/stream")},gotoSettings:function(){return Finch.navigate("/settings")},gotoSearch:function(a){return Finch.navigate("/search",a,!0)},gotoProfile:function(a){return a instanceof B?Finch.navigate("/profile/"+a.get("id")):Finch.navigate("/profile")}},"undefined"==typeof ENV||null===ENV)throw"Could not find ENV variables";this.Application=a=new b,SC.initialize({client_id:ENV.SOUNDCLOUD_CLIENT_ID,redirect_uri:ENV.SOUNDCLOUD_REDIRECT_URL}),balanced.init(ENV.BALANCED_MAKRETPLACE_URI),Falcon.apply(a),Finch.listen()}).call(this);