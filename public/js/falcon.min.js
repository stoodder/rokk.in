/*
	Falcon.js
	by Rick Allen (stoodder)

	Version 0.9.0
	Full source at https://github.com/stoodder/falconjs
	Copyright (c) 2013 Rick Allen, http://www.stoodder.com

	MIT License, https://github.com/stoodder/falconjs/blob/master/LICENSE.md
*/


(function(){var ChainedCollection,Falcon,arrayRemove,arrayUnique,clone,extend,findKey,isArray,isBoolean,isEmpty,isFunction,isNaN,isNumber,isObject,isString,key,objectKeys,startsWith,trim,value,_foreach,_getItems,_options,_ref,_ref1,_ref2,_shouldUpdate,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};isObject=function(a){return null!=a&&"[object Object]"===Object.prototype.toString.call(a)},isFunction=function(a){return null!=a&&"[object Function]"===Object.prototype.toString.call(a)},isBoolean=function(a){return null!=a&&"[object Boolean]"===Object.prototype.toString.call(a)},isArray=function(a){return null!=a&&"[object Array]"===Object.prototype.toString.call(a)},isString=function(a){return null!=a&&"[object String]"===Object.prototype.toString.call(a)},isNumber=function(a){return null!=a&&"[object Number]"===Object.prototype.toString.call(a)},isNaN=function(a){return isNumber(a)&&a!==a},isEmpty=function(a){var b,c;if(isObject(a)){for(b in a)return c=a[b],!1;return!0}return isString(a)||isArray(a)?0===a.length:null===a||"undefined"==typeof a?!0:!1},trim=function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},startsWith=function(a,b){return 0===a.indexOf(b)},objectKeys=function(a){var b,c;c=[];for(b in a)c.push(b);return c},extend=function(a,b){var c,d;null==a&&(a={}),isObject(b)||(b={});for(c in b)d=b[c],a[c]=d;return a},findKey=function(a,b){var c,d;for(c in a)if(d=a[c],d===b)return c;return void 0},clone=function(a){var b,c,d;if(!isObject(a))return a;if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return b="",null!=a.global&&(b+="g"),null!=a.ignoreCase&&(b+="i"),null!=a.multiline&&(b+="m"),null!=a.sticky&&(b+="y"),new RegExp(a.source,b);d=new a.constructor;for(c in a)d[c]=clone(a[c]);return d},arrayUnique=function(a){var b,c,d,e,f;for(c={},e=0,f=a.length;f>e;e++)b=a[e],c[b]=!0;return function(){var a;a=[];for(b in c)d=c[b],a.push(b);return a}()},arrayRemove=function(a,b){var c,d,e,f;if(!isArray(a))return[];for(isArray(b)||(b=[b]),d=0,f=b.length;f>d;d++)c=b[d],a=function(){var b,d,f;for(f=[],b=0,d=a.length;d>b;b++)e=a[b],e!==c&&f.push(e);return f}();return a},this.Falcon=Falcon={version:"0.9.0",applicationElement:"body",baseApiUrl:"",baseTemplateUrl:"",cache:!0,deferEvaluation:!0,apply:function(a,b,c){var d,e;isFunction(b)&&(d=[c,b],b=d[0],c=d[1]),isString(b)||(b=""),b=trim(b),isEmpty(b)&&(b=null!=(e=Falcon.applicationElement)?e:"body"),isFunction(c)||(c=function(){}),document.createElement("template"),$(function(){var d;return $("template").each(function(a,b){var c;return b=$(b),c=b.attr("id"),null!=c&&Falcon.View.cacheTemplate("#"+c,b.html()),b.remove()}),d=$(b),d.attr("data-bind","view: $data"),ko.applyBindings(ko.observable(a),d[0]),c()})},isModel:function(a){return null!=a&&a instanceof Falcon.Model},isCollection:function(a){return null!=a&&a instanceof Falcon.Collection},isView:function(a){return null!=a&&a instanceof Falcon.View},isDataObject:function(a){return null!=a&&(a instanceof Falcon.Model||a instanceof Falcon.Collection)},isFalconObject:function(a){return null!=a&&a instanceof Falcon.Object},addBinding:function(a,b,c){var d;return isBoolean(b)&&(d=[c,b],b=d[0],c=d[1]),c&&(ko.virtualElements.allowedBindings[a]=!0),isFunction(b)&&(b={update:b}),ko.bindingHandlers[a]=b},getBinding:function(a){return ko.bindingHandlers[a]}},Falcon.Object=function(){function a(){var a,c,d,e,f,g,h,i;if(this.__falcon_object__events__={},this.__falcon_object__cid__=b++,isObject(this.defaults)){d=this.defaults;for(a in d)c=d[a],this[a]=isFunction(c)?c.apply(this,arguments):isObject(c)?clone(c):c}if(isObject(this.observables)){e=this.observables;for(a in e)c=e[a],isFunction(c)?this[a]=ko.computed({read:c,owner:this,deferEvaluation:null!=(f=Falcon.deferEvaluation)?f:!0}):isObject(c)&&("read"in c||"write"in c)?(c.owner=null!=(g=c.owner)?g:this,c.deferEvaluation=null!=(h=null!=(i=c.deferEvaluation)?i:Falcon.deferEvaluation)?h:!0,this[a]=ko.computed(c)):this[a]=isArray(c)?ko.observableArray(c.slice(0)):ko.observable(c)}}var b;return b=0,a.prototype.observables=null,a.prototype.defaults=null,a.extend=function(a,b){var c,d,e,f,g;f=this,d=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return f.apply(this,arguments)};for(e in f)g=f[e],d[e]=g;for(e in b)g=b[e],d[e]=g;c=function(){this.constructor=d},c.prototype=f.prototype,d.prototype=new c;for(e in a)g=a[e],d.prototype[e]=g;return d.__super__=f.prototype,d},a.prototype.__falcon_object__events__=null,a.prototype.__falcon_object__cid__=null,a.prototype.on=function(a,b,c){var d;return isString(a)&&isFunction(b)?(null==c&&(c=this),a=trim(a).toLowerCase(),isEmpty(a)?this:((null!=(d=this.__falcon_object__events__)[a]?(d=this.__falcon_object__events__)[a]:d[a]=[]).push({callback:b,context:c}),this)):this},a.prototype.off=function(a,b){var c;return isString(a)?(a=trim(a).toLowerCase(),isEmpty(a)||null==this.__falcon_object__events__[a]?this:(isFunction(b)?(this.__falcon_object__events__[a]=function(){var d,e,f,g;for(f=this.__falcon_object__events__[a],g=[],d=0,e=f.length;e>d;d++)c=f[d],c.callback!==b&&g.push(c);return g}.call(this),this.__falcon_object__events__[a].length<=0&&(this.__falcon_object__events__[a]=null)):this.__falcon_object__events__[a]=null,this)):this},a.prototype.has=function(a,b){var c,d,e,f;if(!isString(a))return!1;if(a=trim(a).toLowerCase(),isEmpty(a)||null==this.__falcon_object__events__[a])return!1;if(null!=this.__falcon_object__events__[a]&&!isFunction(b))return!0;for(f=this.__falcon_object__events__[a],d=0,e=f.length;e>d;d++)if(c=f[d],c.callback===b)return!0;return!1},a.prototype.trigger=function(){var a,b,c,d,e,f;if(b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],!isString(b))return this;if(b=trim(b).toLowerCase(),isEmpty(b)||null==this.__falcon_object__events__[b])return this;for(f=this.__falcon_object__events__[b],d=0,e=f.length;e>d;d++)c=f[d],c.callback.apply(c.context,a);return this},a}(),Falcon.Model=function(a){function b(a,c){var d,e;return b.__super__.constructor.apply(this,arguments),a=ko.utils.unwrapObservable(a),c=ko.utils.unwrapObservable(c),null!=c&&!Falcon.isModel(c)&&Falcon.isModel(a)&&(d=[a,c],c=d[0],a=d[1]),null==c&&Falcon.isModel(a)&&(e=[a,c],c=e[0],a=e[1]),Falcon.isModel(a)&&(a=a.unwrap()),this.parent=c,this.initialize(a),isEmpty(a)||this.fill(a),this}return __extends(b,a),b.extend=Falcon.Object.extend,b.prototype.id=null,b.prototype.url=null,b.prototype.parent=null,b.prototype.initialize=function(){},b.prototype.get=function(a){return isString(a)?ko.utils.unwrapObservable(this[a]):this.undefined},b.prototype.set=function(a,b){var c,d;if(isObject(a)){for(c in a)d=a[c],this.set(c,d);return this}return isString(a)?(ko.isObservable(this[a])?this[a](b):this[a]=b,this):this},b.prototype.toggle=function(a){return this.set(a,!this.get(a))},b.prototype.parse=function(a){return a},b.prototype.fill=function(a){var b,c,d,e;if((isNumber(a)||isString(a))&&(a={id:a}),!isObject(a))return this;if(Falcon.isModel(a)&&(a=a.unwrap()),isEmpty(a))return this;c={},e=Falcon.Model.prototype;for(b in e)d=e[b],"id"!==b&&"url"!==b&&(c[b]=!0);for(b in a)d=a[b],c[b]||(d=ko.utils.unwrapObservable(d),Falcon.isModel(this[b])?isEmpty(d)||this[b].fill(d):Falcon.isCollection(this[b])?this[b].fill(d):ko.isWriteableObservable(this[b])?this[b](d):this[b]=d);return this},b.prototype.unwrap=function(){var a,b,c;b={};for(a in this)c=this[a],"id"!==a&&a in Falcon.Model.prototype||(b[a]=Falcon.isDataObject(c)?c.unwrap():c);return b},b.prototype.serialize=function(a){var b,c,d,e,f,g,h;if(d={},null==a?a=function(){var a;a=[];for(b in this)"id"!==b&&b in Falcon.Model.prototype||a.push(b);return a}.call(this):isString(a)&&(a=trim(a).split(",")),isArray(a)){for(c={},g=0,h=a.length;h>g;g++)b=a[g],c[b]=null;a=c}if(!isObject(a))return d;for(b in a)e=a[b],f=this[b],Falcon.isDataObject(f)?d[b]=f.serialize(e):ko.isObservable(f)?d[b]=ko.utils.unwrapObservable(f):isFunction(f)||(d[b]=f);return d},b.prototype.makeUrl=function(a,b,c){var d,e,f,g,h,i,j;return i=isFunction(this.url)?this.url():this.url,isString(i)||(i=""),i=trim(i),isString(a)||(a=""),a=a.toUpperCase(),"GET"!==a&&"PUT"!==a&&"POST"!==a&&"DELETE"!==a&&(a="GET"),void 0===c&&(isString(b)||isNumber(b))&&(j=[c,b],b=j[0],c=j[1]),b=void 0!==b?b:this.parent,d="",h=i.lastIndexOf("."),h>-1&&(d=i.slice(h),i=i.slice(0,h)),startsWith(i,"/")||(i="/"+i),Falcon.isModel(b)?(g=b.makeUrl(),e=g.lastIndexOf("."),f=g.lastIndexOf("/"),e>f&&(e>-1&&(g=g.slice(0,e)),g=trim(g)),i=""+g+i):isString(Falcon.baseApiUrl)&&(i=""+Falcon.baseApiUrl+i),("GET"===a||"PUT"===a||"DELETE"===a)&&("/"!==i.slice(-1)&&(i+="/"),i+=null!=c?c:this.get("id")),i=i.replace(/([^:])\/\/+/gi,"$1/").replace(/^\/\//gi,"/"),""+i+d},b.prototype.validate=function(){return!0},b.prototype.sync=function(a,b,c){var d,e,f,g,h,i,j=this;return isFunction(b)&&(b={complete:b}),isString(b)&&(b={attributes:trim(b).split(",")}),isArray(b)&&(b={attributes:b}),isObject(b)||(b={}),isObject(b.data)||(b.data=null),isString(b.dataType)||(b.dataType="json"),isString(b.contentType)||(b.contentType="application/json"),isFunction(b.success)||(b.success=function(){}),isFunction(b.complete)||(b.complete=function(){}),isFunction(b.error)||(b.error=function(){}),Falcon.isModel(b.parent)||null===b.parent||(b.parent=this.parent),null==b.attributes&&(b.attributes=null),isObject(b.params)||(b.params={}),isBoolean(b.fill)||(b.fill=!0),isObject(b.headers)||(b.headers={}),a=trim(isString(a)?a.toUpperCase():"GET"),"GET"!==a&&"POST"!==a&&"PUT"!==a&&"DELETE"!==a&&(a="GET"),b.type=a,"PUT"!==a&&"POST"!==a||this.validate(b)?(null!==b.data||"POST"!==a&&"PUT"!==a||(b.data=this.serialize(b.attributes)),d=null===b.data?"":JSON.stringify(b.data),c=null!=(h=null!=c?c:b.context)?h:this,f=null!=(i=b.url)?i:this.makeUrl(a,b.parent),isEmpty(b.params)||(f.indexOf("?")>-1||(f+="?"),f+=function(){var a,c;a=b.params,c=[];for(e in a)g=a[e],c.push(""+e+"="+g);return c}().join("&")),$.ajax({type:a,url:f,data:d,dataType:b.dataType,contentType:b.contentType,cache:Falcon.cache,headers:b.headers,success:function(d,e,f){var g;switch(isString(d)&&(d=JSON.parse(d)),null==d&&isString(f.responseText)&&(d=JSON.parse(f.responseText)),null==d&&(d={}),g=j.parse(d,b,f),b.fill&&j.fill(g,b),a){case"GET":j.trigger("fetch",g);break;case"POST":j.trigger("create",g);break;case"PUT":j.trigger("save",g);break;case"DELETE":j.trigger("destroy",g)}return b.success.call(c,j,d,e,f)},error:function(a){var d,e;e=a.responseText;try{isString(e)&&(e=JSON.parse(e))}catch(f){d=f}return b.error.call(c,j,e,a)},complete:function(a,d){return b.complete.call(c,j,a,d)}})):void 0},b.prototype.fetch=function(a,b){return this.sync("GET",a,b)},b.prototype.create=function(a,b){return this.sync("POST",a,b)},b.prototype.save=function(a,b){return this.isNew()?this.create(a,b):this.sync("PUT",a,b)},b.prototype.destroy=function(a,b){return this.sync("DELETE",a,b)},b.prototype.equals=function(a){var b,c;return a=ko.utils.unwrapObservable(a),Falcon.isModel(a)?(b=this.get("id"),c=a.get("id"),null!=b&&null!=c?a.get("id")===this.get("id"):a===this):isNumber(a)||isString(a)?a===this.get("id"):!1},b.prototype.mixin=function(a){var b,c,d,e=this;isObject(a)||(a={});for(b in a)c=a[b],Falcon.isDataObject(this[b])?this[b].mixin(c):ko.isObservable(c)?this[b]=ko.observable(null!=(d=this[b])?d:ko.utils.unwrapObservable(c)):isFunction(c)?!function(){var a;return a=c,e[b]=function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],a.call.apply(a,[e,e].concat(__slice.call(b)))}}():null==this[b]&&(this[b]=c);return this},b.prototype.clone=function(a,b){var c;return(null===a||Falcon.isModel(a))&&(c=[void 0,a],a=c[0],b=c[1]),null===b||Falcon.isModel(b)||(b=this.parent),new this.constructor(this.serialize(a),b)},b.prototype.isNew=function(){return null==this.get("id")},b}(Falcon.Object),Falcon.View=function(a){function b(){var a,d,e=this;return b.__super__.constructor.apply(this,arguments),a=this.makeUrl(),this._is_rendered=!1,this.is_loaded=ko.observable(!1),this.__falcon_view__child_views__=[],d=function(){return e.__falcon_view__loaded_url__=a,e.is_loaded(!0)},this.initialize.apply(this,arguments),isEmpty(a)||a in c?d():startsWith(a,"#")?(Falcon.View.cacheTemplate(a,$(a).html()),d()):$.ajax({url:a,type:"GET",cache:Falcon.cache,error:function(){return console.log("[FALCON] Error Loading Template: '"+a+"'"),e.trigger("error")},success:function(b){return Falcon.View.cacheTemplate(a,b),d()}}),this}var c;return __extends(b,a),c={},b.cacheTemplate=function(a,b){isString(a)||(a=""),isString(b)||(b=""),a=trim(a),c[a]=b},b.resetCache=function(){c={}},b.extend=Falcon.Object.extend,b.prototype.url=null,b.prototype.is_loaded=!1,b.prototype._is_rendered=!1,b.prototype.__falcon_view__child_views__=null,b.prototype.__falcon_view__loaded_url__=null,b.prototype.makeUrl=function(){var a;return a=ko.utils.unwrapObservable(this.url),isFunction(a)&&(a=a()),isString(a)||(a=""),a=trim(a),"#"===a.charAt(0)?a:("/"!==a.charAt(0)&&(a="/"+a),isString(Falcon.baseTemplateUrl)&&(a=""+Falcon.baseTemplateUrl+a),a=a.replace(/([^:])\/\/+/gi,"$1/"))},b.prototype.template=function(){var a;return ko.utils.unwrapObservable(this.is_loaded)?null!=(a=c[this.__falcon_view__loaded_url__])?a:"":""},b.prototype._render=function(){this._is_rendered||(this.display.apply(this,arguments),this._is_rendered=!0)},b.prototype._unrender=function(){var a,b,c,d;if(this._is_rendered){for(d=this.__falcon_view__child_views__,b=0,c=d.length;c>b;b++)a=d[b],a._unrender();this.__falcon_view__child_views__=[],this.dispose.apply(this,arguments),this._is_rendered=!1}},b.prototype._addChildView=function(a){return Falcon.isView(a)?this.__falcon_view__child_views__.push(a):void 0},b.prototype.initialize=function(){},b.prototype.display=function(){},b.prototype.dispose=function(){},b.__falcon_view__viewModel__=null,b.prototype.viewModel=function(){var a,b,c,d=this;if(null!=this.__falcon_view__viewModel__)return this.__falcon_view__viewModel__;c={__falcon_view__addChildView__:function(a){return d._addChildView(a)}};for(a in this)b=this[a],a in Falcon.View.prototype||(isFunction(b)&&!ko.isObservable(b)&&(b=function(){var a;return a=b,function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],a.call.apply(a,[d].concat(__slice.call(b)))}}()),c[a]=b);return this.__falcon_view__viewModel__=c},b}(Falcon.Object),Falcon.Collection=function(a){function b(a,c){var d,e;b.__super__.constructor.apply(this,arguments),a=ko.utils.unwrapObservable(a),c=ko.utils.unwrapObservable(c),null==c&&Falcon.isModel(a)&&(d=[a,c],c=d[0],a=d[1]),Falcon.isModel(a)&&isArray(c)&&(e=[a,c],c=e[0],a=e[1]),null!=this.model&&null==this.url&&(this.url=this.model.prototype.url),this.length=ko.observable(0),this.parent=c,this.__falcon_collection__mixins__=[],this.reset(),isEmpty(a)||this.fill(a),this.initialize(a)}var c;return __extends(b,a),b.extend=Falcon.Object.extend,c=function(a){var b,c,d;return Falcon.isModel(a)?(c=a,d=c.get("id"),null!=d?function(a){var b,d;return Falcon.isModel(a)?(b=a.get("id"),d=c.get("id"),b===d):!1}:function(a){return Falcon.isModel(a)?a===c:!1}):isNumber(a)||isString(a)?(b=a,function(a){return Falcon.isModel(a)?a.get("id")===b:!1}):a},b.prototype.__falcon_collection__mixins__=null,b.prototype.__falcon_collection__change_count__=0,b.prototype.models=null,b.prototype.model=null,b.prototype.url=null,b.prototype.length=0,b.prototype.parent=null,b.prototype.comparator=null,b.prototype.initialize=function(){},b.prototype.parse=function(a){return a},b.prototype.fill=function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;if(null==this.model)return this;if(null==a&&(a=[]),Falcon.isCollection(a)&&(a=a.models()),ko.isObservable(a)&&(a=ko.utils.unwrapObservable(a)),isArray(a)||(a=[a]),m=[],isObject(b)||(b={}),k=b.method,isString(k)||(k=""),k=k.toLowerCase(),"replace"!==k&&"append"!==k&&"prepend"!==k&&"insert"!==k&&"merge"!==k&&(k="replace"),d=null!=(B=b.comparator)?B:this.comparator,"replace"!==k&&isEmpty(a))return[];for(this.__falcon_collection__change_count__++,f=o=0,s=a.length;s>o;f=++o)for(i=a[f],Falcon.isModel(i)?i instanceof this.model?(m[f]=a[f],null!=this.parent&&(m[f].parent=this.parent)):m[f]=new this.model(i.serialize(),this.parent):m[f]=new this.model(i,this.parent),C=this.__falcon_collection__mixins__,p=0,t=C.length;t>p;p++)j=C[p],m[f].mixin(j);if("replace"===k)A=m;else if("merge"===k)for(A=this.models(),q=0,u=m.length;u>q;q++){for(l=m[q],h=c(l),z=null,r=0,v=A.length;v>r;r++)if(i=A[r],h(i)){z=i;break}z?z.fill(l):A.push(l)}else if("prepend"===k)for(x=m.length-1,A=this.models(),f=y=0,w=m.length;w>y;f=++y)l=m[f],A.unshift(m[x-f]);else"append"===k?(A=this.models(),A=A.concat(m)):"insert"===k&&(g=null!=(D=b.insert_index)?D:-1,A=this.models(),0>g||g>=A.length?A=A.concat(m):(e=A.slice(0,g),n=A.slice(g),A=e.concat(m,n)));return isFunction(d)&&A.sort(d),this.models(A),this.length(this.models().length),m},b.prototype.unwrap=function(){var a,b,c,d;b=[],d=this.models();for(a in d)c=d[a],b[a]=Falcon.isDataObject(c)?c.unwrap():c;return b},b.prototype.serialize=function(a){var b,c,d,e;c=[],e=this.models();for(b in e)d=e[b],c[b]=Falcon.isDataObject(d)?d.serialize(a):d;return c},b.prototype.makeUrl=function(a,b){var c,d,e,f;return f=isFunction(this.url)?this.url():this.url,isString(f)||(f=""),f=trim(f),isString(a)||(a=""),a=a.toUpperCase(),"GET"!==a&&"PUT"!==a&&"POST"!==a&&"DELETE"!==a&&(a="GET"),startsWith(f,"/")||(f="/"+f),b=void 0===b?this.parent:b,Falcon.isModel(b)?(e=b.makeUrl(),c=e.lastIndexOf("."),d=e.lastIndexOf("/"),c>d&&(c>-1&&(e=e.slice(0,c)),e=trim(e)),f=""+e+f):isString(Falcon.baseApiUrl)&&(f=""+Falcon.baseApiUrl+f),f=f.replace(/([^:])\/\/+/gi,"$1/").replace(/^\/\//gi,"/")},b.prototype.sync=function(a,b,c){var d,e,f,g,h,i,j=this;return isFunction(b)&&(b={complete:b}),isString(b)&&(b={attributes:trim(b).split(",")}),isArray(b)&&(b={attributes:b}),isObject(b)||(b={}),isObject(b.data)||(b.data=null),isString(b.dataType)||(b.dataType="json"),isString(b.contentType)||(b.contentType="application/json"),isFunction(b.success)||(b.success=function(){}),isFunction(b.complete)||(b.complete=function(){}),isFunction(b.error)||(b.error=function(){}),Falcon.isModel(b.parent)||null===b.parent||(b.parent=this.parent),null==b.attributes&&(b.attributes=null),isObject(b.params)||(b.params={}),isBoolean(b.fill)||(b.fill=!0),isObject(b.headers)||(b.headers={}),a=trim(isString(a)?a.toUpperCase():"GET"),"GET"!==a&&"POST"!==a&&"PUT"!==a&&"DELETE"!==a&&(a="GET"),d=null===b.data?"":JSON.stringify(b.data),c=null!=(h=null!=c?c:b.context)?h:this,f=null!=(i=b.url)?i:trim(this.makeUrl(a,b.parent)),isEmpty(b.params)||(f.indexOf("?")>-1||(f+="?"),f+=function(){var a,c;a=b.params,c=[];for(e in a)g=a[e],c.push(""+e+"="+g);return c}().join("&")),$.ajax({url:f,type:a,data:d,dataType:b.dataType,contentType:b.contentType,cache:Falcon.cache,headers:b.headers,success:function(d,e,f){var g;return isString(d)&&(d=JSON.parse(d)),null==d&&isString(f.responseText)&&(d=JSON.parse(f.responseText)),null==d&&(d=[]),g=j.parse(d,b,f),"GET"===a&&(b.fill&&j.fill(g,b),j.trigger("fetch",g)),b.success.call(c,j,d,e,f)},error:function(a){var d,e;e=a.responseText;try{isString(e)&&(e=JSON.parse(e))}catch(f){d=f}return b.error.call(c,j,e,a)},complete:function(a,d){return b.complete.call(c,j,a,d)}})},b.prototype.fetch=function(a,b){return this.sync("GET",a,b)},b.prototype.create=function(a,b,c){var d,e=this;if(null!=this.model)return Falcon.isModel(a)&&(a=a.unwrap()),isObject(a)||(a={}),isFunction(b)&&(b={success:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),isString(b.method)||(b.method="append"),d=b.success,b.success=function(a){var c,f;return c=e.fill(a,b),d.apply(null!=(f=c[0])?f:a,arguments)},new this.model(a,this.parent).create(b,c)},b.prototype.destroy=function(a,b,c){var d,e=this;return null==this.model?null:(a=this.first(ko.utils.unwrapObservable(a)),Falcon.isModel(a)?(isFunction(b)&&(b={success:b}),isObject(b)||(b={}),isFunction(b.success)||(b.success=function(){}),void 0===b.parent&&(b.parent=this.parent),d=b.success,b.success=function(a){return e.remove(a),d.apply(a,arguments)},a.destroy(b,c)):null)},b.prototype.remove=function(a){var b;return a=ko.utils.unwrapObservable(a),Falcon.isCollection(a)&&(a=a.models()),this.__falcon_collection__change_count__++,b=isArray(a)?this.models.removeAll(a):this.models.remove(c(a)),isEmpty(b)||this.length(this.models().length),this},b.prototype.append=function(a){return this.fill(a,{method:"append"})},b.prototype.prepend=function(a){return this.fill(a,{method:"prepend"})},b.prototype.insert=function(a,b){var d,e;return e=c(b),isFunction(e)?(d=this.indexOf(b),this.fill(a,{method:"insert",insert_index:d})):this.fill(a,{method:"append"})},b.prototype.unshift=function(){return this.prepend.apply(this,arguments)},b.prototype.shift=function(){var a;return a=this.models.shift(),this.length(this.models().length),a},b.prototype.push=function(){return this.append.apply(this,arguments)},b.prototype.pop=function(){var a;return this.__falcon_collection__change_count__++,a=this.models.pop(),this.length(this.models().length),a},b.prototype.sort=function(a){return isFunction(a)?this.models.sort(a):models},b.prototype.at=function(a){var b;return a=parseInt(a),isNaN(a)?null:(b=this.models(),0>a||a>=b.length?null:b[a])},b.prototype.indexOf=function(a){var b,d,e,f,g;if(Falcon.isModel(a))return this.models.indexOf(a);if(d=c(a),!isFunction(d))return-1;for(g=this.models(),b=e=0,f=g.length;f>e;b=++e)if(a=g[b],d(a))return b;return-1},b.prototype.lastIndexOf=function(a){var b,d,e,f,g,h,i;if(e=c(a),!isFunction(e))return-1;for(g=this.models(),f=g.length,b=h=0,i=g.length;i>h;b=++h)if(a=g[b],d=f-b-1,e(g[d]))return d;return-1},b.prototype.each=function(a,b){var c,d,e,f,g,h,i,j;if(!isFunction(a))return this;if(null==b&&(b=this),1===a.length)for(i=this.models(),e=0,g=i.length;g>e;e++)d=i[e],a.call(b,d);else for(j=this.models(),c=f=0,h=j.length;h>f;c=++f)d=j[c],a.call(b,c,d);return this},b.prototype.first=function(a){var b,d,e,f;for(a=c(a),isFunction(a)||(a=function(){return!0}),f=this.models(),d=0,e=f.length;e>d;d++)if(b=f[d],a(b))return b;return null},b.prototype.last=function(a){var b,d,e,f,g,h;for(a=c(a),isFunction(a)||(a=function(){return!0}),f=this.models(),e=f.length,b=g=0,h=f.length;h>g;b=++g)if(d=f[b],d=f[e-b-1],a(d))return d;return null},b.prototype.filter=function(a){var b;return a=c(a),isFunction(a)?function(){var c,d,e,f;for(e=this.models(),f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)&&f.push(b);return f}.call(this):this.models()},b.prototype.any=function(a){var b,d,e,f;if(a=c(a),!isFunction(a))return!1;for(f=this.models(),d=0,e=f.length;e>d;d++)if(b=f[d],a(b))return!0;return!1},b.prototype.without=function(a){var b;return a=c(a),isFunction(a)?function(){var c,d,e,f;for(e=this.models(),f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)||f.push(b);return f}.call(this):this.models()},b.prototype.pluck=function(a,b){var c,d,e,f,g;for(isString(a)||(a=""),isBoolean(b)||(b=!0),e=[],d=this.models(),f=0,g=d.length;g>f;f++)c=d[f],null!=c?e.push(b?ko.utils.unwrapObservable(c[a]):c[a]):e.push(void 0);return e},b.prototype.slice=function(a,b){return this.models.slice(a,b)},b.prototype.chain=function(){var a;return a=new ChainedCollection,a.model=this.model,a.fill(this.models()),a},b.prototype.mixin=function(a){var b,c,d,e,f,g,h,i=this;isObject(a)||(a={}),h={};for(b in a)e=a[b],ko.isObservable(e)?h[b]=ko.observable(ko.utils.unwrapObservable(e)):isFunction(e)?!function(){var a;return a=e,h[b]=function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],a.apply(b[0],[b[0],i].concat(b.slice(1)))},h[b].length=a.length}():h[b]=e;for(d=this.models(),f=0,g=d.length;g>f;f++)c=d[f],Falcon.isDataObject(c)&&c.mixin(h);return this.__falcon_collection__mixins__.push(h),this},b.prototype.clone=function(a,b){var c;return(null===a||Falcon.isModel(a))&&(c=[void 0,a],a=c[0],b=c[1]),null===b||Falcon.isModel(b)||(b=this.parent),new this.constructor(this.serialize(a),b)},b.prototype.reset=function(){return this.__falcon_collection__change_count__++,null!=this.models?this.models([]):this.models=ko.observableArray([]),this.length(0),this},b}(Falcon.Object),ChainedCollection=function(a){function b(){return _ref=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.slice=function(){return this.models(b.__super__.slice.apply(this,arguments)),this},b.prototype.sort=function(){return this.models(b.__super__.sort.apply(this,arguments)),this},b.prototype.filter=function(){return this.models(b.__super__.filter.apply(this,arguments)),this},b.prototype.without=function(){return this.models(b.__super__.without.apply(this,arguments)),this},b}(Falcon.Collection),ko.bindingHandlers.view=function(){var getTemplate,getViewModel,makeTemplateValueAccessor,returnVal;return makeTemplateValueAccessor=function(a){return function(){return{data:a,templateEngine:ko.nativeTemplateEngine.instance}}},getViewModel=function(a){var b,c;return b={},null==a&&(a={}),b=a instanceof Falcon.View?a.viewModel():ko.utils.unwrapObservable(null!=(c=a.viewModel)?c:{})},getTemplate=function(a){var b,c;return b="",null==a&&(a={}),b=a instanceof Falcon.View?a.template():ko.utils.unwrapObservable(null!=(c=a.template)?c:"")},returnVal={controlsDescendantBindings:!0},{init:function(a,b){var c,d,e,f;return f=b(),null!=f&&ko.isSubscribable(f)?(d=ko.utils.unwrapObservable(f),e=f.subscribe(function(a){return Falcon.isView(d)&&d._unrender(),d=a}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){return Falcon.isView(d)&&d._unrender(),e.dispose()})):Falcon.isView(f)&&ko.utils.domNodeDisposal.addDisposeCallback(a,function(){return f._unrender()}),c=document.createElement("div"),ko.utils.domData.set(a,"__falcon_view__container__",c),new ko.templateSources.anonymousTemplate(a).nodes(c),returnVal},update:function(element,valueAccessor,allBindingsAccessor,viewModel,context){var childContext,container,execScripts,template,value;return value=valueAccessor(),value=ko.utils.unwrapObservable(value),viewModel=getViewModel(value),template=getTemplate(value),null==value&&ko.virtualElements.emptyNode(element),isObject(value)?(null!=(null!=context?context.__falcon_view__addChildView__:void 0)&&context.__falcon_view__addChildView__(value),childContext=context.createChildContext(viewModel).extend({$view:viewModel}),isEmpty(viewModel)||isEmpty(template)?ko.virtualElements.emptyNode(element):value instanceof Falcon.View&&!ko.utils.unwrapObservable(value.is_loaded)||(container=ko.utils.domData.get(element,"__falcon_view__container__"),container.innerHTML=template,ko.renderTemplate(element,childContext,{},element),execScripts=!!ko.utils.unwrapObservable(value.execScripts),execScripts===!0&&$(element).find("script").each(function(index,script){return script=$(script),"text/javascript"===script.attr("type").toLowerCase()?eval(script.text()):void 0}),Falcon.isView(value)&&value._render()),returnVal):returnVal}}}(),_getItems=function(a){return a=ko.utils.peekObservable(a),(Falcon.isCollection(a)||isArray(a))&&(a={data:a}),isObject(a)||(a={}),a.data=ko.utils.unwrapObservable(a.data),Falcon.isCollection(a.data)&&(a.data=a.data.models()),null==a.data&&(a.data=[]),function(){return a}},_shouldUpdate=function(a,b){var c,d,e,f;return Falcon.isCollection(b)?(e=ko.utils.domData.get(a,"__falcon_object__cid__"),c=b.__falcon_object__cid__,d=b.__falcon_collection__change_count__,f=ko.utils.domData.get(a,"__falcon_collection___change_count__"),f===d&&e===c?!1:(ko.utils.domData.set(a,"__falcon_object__cid__",c),ko.utils.domData.set(a,"__falcon_collection___change_count__",d),!0)):!0},_foreach=null!=(_ref1=ko.bindingHandlers.foreach)?_ref1:{},ko.bindingHandlers.foreach={init:function(){var a,b,c,d;return b=arguments[0],d=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],c=ko.utils.unwrapObservable(d()),ko.utils.domData.set(b,"__falcon_collection___change_count__",-1),_foreach.init.apply(_foreach,[b,_getItems(c)].concat(__slice.call(a)))},update:function(){var a,b,c,d;return b=arguments[0],d=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],c=ko.utils.unwrapObservable(d()),_shouldUpdate(b,c)?_foreach.update.apply(_foreach,[b,_getItems(c)].concat(__slice.call(a))):void 0}};for(key in _foreach)value=_foreach[key],key in ko.bindingHandlers.foreach||(ko.bindingHandlers.foreach[key]=value);_options=null!=(_ref2=ko.bindingHandlers.options)?_ref2:function(){},ko.bindingHandlers.options=function(){return{init:function(){var a,b,c,d;return b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],value=ko.utils.unwrapObservable(c()),ko.utils.domData.set(b,"__falcon_collection___change_count__",-1),(null!=(d=_options.init)?d:function(){}).apply(null,[b,_getItems(value)].concat(__slice.call(a)))},update:function(){var a,b,c,d;return b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],value=ko.utils.unwrapObservable(c()),_shouldUpdate(b,value)?(null!=(d=_options.update)?d:function(){}).apply(null,[b,_getItems(value)].concat(__slice.call(a))):void 0}}}(),ko.bindingHandlers.log={update:function(a,b){return console.log(ko.utils.unwrapObservable(b()))}},ko.virtualElements.allowedBindings.view=!0,ko.virtualElements.allowedBindings.log=!0}).call(this);